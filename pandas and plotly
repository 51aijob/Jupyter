# Jupyter
#data analysis and dataframe get from MySQL

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

import pymysql
import time

import plotly
import cufflinks as cf
cf.go_offline()

import re

#import Simpons methold to calculate area
from scipy.integrate import simps

#get info from mysql and save to df
def get_data_from_sql(db,table):
    conn=pymysql.connect(host="localhost",user="root",db=db,charset="utf8")
    sql = "select * from {}".format(table)
    df = pd.read_sql_query(sql,conn)
    return(df)

df=get_data_from_sql('resumeDB','test')

with open('df','w') as file:
    file.write(str(df))

columns="english perl python tcl c word js css php mysql"
columns=list(columns.split(' '))

#plot with iplot
def plot_data(df):
    df.iplot(x='id',y=columns,title='Score Per Resume')
plot_data(df)

def get_data_from_file_and_plot():
    with open('columns','r') as file:
        for line in file:
            line = line.strip()
            columns=list(line.split(' '))
    columns.insert(0,'id')

    d={}
    for column in columns:
        d[column]=[]

    reg = re.compile('\d+\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)\s+(\d+)')
    i = 0
    with open('df','r') as file:
        for line in file:
            if i != 0:
                line = line.strip()
                line_tuple=reg.match(line).groups()
                for j in range(len(columns)):
                    d[columns[j]].append(line_tuple[j])
            else:
                i = i + 1

    df = pd.DataFrame.from_dict(d)
    
    columns_str = ''
    for column in columns:
        columns_str+' '+column

    df.iplot(x='id',y=columns_str)

get_data_from_file_and_plot()
